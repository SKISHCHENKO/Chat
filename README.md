
## Архитектура приложения Сетевой Чат: ##  

## Серверная часть ##

### 1. Сервер: ###
- Сервер запускается, загружает настройки из settings.txt и данные пользователей из файла users.txt, после чего открывает ServerSocket, чтобы прослушивать входящие подключения клиентов на указанном порту.    
- Cервер запускает цикл, принимая входящие подключения и создавая новый поток для каждого пользователя с помощью объекта класса ClientHandler.  

### 2. ClientHandler (один поток на одного юзера) ###
- Каждый подключенный пользователь обрабатывается в индивидуальном потоке, что позволяет одновременно поддерживать связь с несколькими пользователями.  
- Считывание и запись данных через BufferedReader и PrintWriter.  
- Обработка входа в систему или регистрации пользователя при подключении.  
- Управление обменом сообщениями с клиентом, постоянное прослушивание сообщений, их отправка на сервер и рассылка другим подключённым пользователям.  

### 3. Управление пользователями ###
- Вход в систему: когда пользователь выбирает вход, сервер проверяет его учетные данные по сохранённым данным пользователей в файле users.txt. Если вход успешен,  пользователь получает доступ к чату.   
- Регистрация: Новые пользователи могут зарегистрироваться, указав уникальные имя пользователя и пароль, которые сохраняются в файл для последующих входов.  
- Обработка гостей: Если вход или регистрация не удались, пользователи обрабатываются как "гости" и при неудачной регистрации или авторизации отключаются от чата.  

### 4. Рассылка сообщений ###
- После успешной авторизации пользователя сервер рассылает его сообщения всем подключённым.  
- Каждое сообщение, отправленное любым пользователем, пересылается всем через потокобезопасную clientWriters и метод broadcastMessage(String message).  

### 5. Многопоточность ###
- Каждый пользователь обрабатывается в своём потоке, сервер поддерживает работу с несколькими пользователями одновременно.  
- Потокобезопасность: Для хранения активных пользователей используется потокобезопасная ConcurrentHashMap в виде Map<String, PrintWriter> clientWriters.    

### 6. Обработка ошибок и отключений ###
- Если пользователь отключается или происходит ошибка, ClientHandler закрывает соединение, удаляет пользователя из списка активных пользователей и записывает событие в лог.  
- Пользователь может отправить команду "exit", чтобы самому покинуть чат, сервер в этом случае отключает пользователя.    


## Приложение на стороне пользователя ##

### 1. Основной поток (Main) ###
- Клиентское приложение начинает с загрузки настроек из файла settings.txt, чтобы получить SERVER_ADDRESS и PORT, необходимые для подключения к серверу.  
- Создается соединение с сервером (Socket), и пользователь подключается к нему через указанный адрес и порт.  
### 2. Авторизация и регистрация ###
- Запрашивается у пользователя выбор (вход, регистрация или выход).
- Если выбран вход: запрашиваются логин и пароль. Сервер проверяет эти данные (Map<String, String> users) и возвращает результат (успешен/не успешен).
- Если выбран процесс регистрации: пользователь должен ввести логин и пароль, которые сервер проверяет на уникальность.
- В случае успешного входа или регистрации пользователь подключаются к чату.    
### 3. Чтение и отправка сообщений: ###
- Пользователь использует два отдельных потока для чтения сообщений с сервера и отправки сообщений на сервер, это позволяетодновременно отправлять и получать сообщения.  
- Поток для чтения входящих сообщений (incomingMessages).  
- Поток для отправки исходящих сообщений (outgoingMessages).  
- Пользователь вводит сообщения, которые отправляются на сервер через PrintWriter.  
- Если пользователь вводит команду "exit", поток завершает работу, отправляет соответствующее сообщение на сервер и закрывает соединение.  
### 4. Обработка завершения работы (CloseConnection) ###
- В случае завершения работы клиента (по команде "exit" или при получении сообщения от сервера об отключении), вызывается метод closeConnection, который закрывает все открытые потоки и сокет, корректно завершая работу клиента.  
### 5. Флаг завершения работы (isRunning) ###
- Переменная isRunning служит для остановки потоков чтения и отправки сообщений при отключении пользователя. Как только один из потоков завершает работу (например, при вводе команды "exit"), оба потока корректно завершаются.  

## Логирование ##

- Вынесено в отдельный класс Log.
- Создан singleton Log instance с использованием механизма синхронизации в методах logToFile() и logError().  
- Логируется подключения, отключения и сообщения пользователей, в файл log.txt с помощью метода log(String msg).    
- Сообщения выводятся на консоль, пересылаются всем пользователям и логируются в файл log.txt для постоянное хранение логов.  

## Файлы ##
- Файл настроек: settings.txt - Содержит конфигурацию сервера (адрес и порт).  
- Файл пользователей: users.txt - хранит учетные данные для авторизации в виде login:password.  
- Файл логов: log.txt - хранит логи, связанные с работой сервера и взаимодействием с пользователями, а также сообщения пользователей.  
- Файл логов: error_log.txt - хранит логи, связанные с ошибками при работе Сервера.  