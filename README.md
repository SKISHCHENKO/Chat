# Сетевой чат #

## Архитектура приложения: ##  

### 1. Основной сервер: ###
- Сервер запускается, загружает настройки из settings.txt и данные пользователей из файла users.txt, после чего открывает ServerSocket, чтобы прослушивать входящие подключения клиентов на указанном порту.    
- Cервер запускает цикл, принимая входящие подключения и создавая новый поток для каждого пользователя с помощью объекта класса ClientHandler.  

### 2. ClientHandler (один поток на одного юзера"): ###
- Каждый подключенный пользователь обрабатывается в индивидуальном потоке, что позволяет одновременно поддерживать связь с несколькими пользователями.  
- Считывание и запись данных через BufferedReader и PrintWriter.  
- Обработка входа в систему или регистрации пользователя при подключении.  
- Управление обменом сообщениями с клиентом, постоянное прослушивание сообщений, их отправка на сервер и рассылка другим подключённым пользователям.  

### 3. Управление пользователями: ###
- Вход в систему: когда пользователь выбирает вход, сервер проверяет его учетные данные по сохранённым данным пользователей в файле users.txt. Если вход успешен,  пользователь получает доступ к чату.   
- Регистрация: Новые пользователи могут зарегистрироваться, указав уникальные имя пользователя и пароль, которые сохраняются в файл для последующих входов.  
- Обработка гостей: Если вход или регистрация не удались, пользователи обрабатываются как "гости" и при неудачной регистрации или авторизации отключаются от чата.  

### 4. Рассылка сообщений: ###
- После успешной авторизации пользователя сервер рассылает его сообщения всем подключённым.  
- Каждое сообщение, отправленное любым пользователем, пересылается всем через потокобезопасную clientWriters и метод broadcastMessage(String message).  

### 5. Логирование: ###
- Логируется подключения, отключения и сообщения пользователей, в файл log.txt с помощью метода log.  
- Сообщения выводятся на консоль, пересылаются всем пользователям и логируются в файл log.txt для постоянное хранение логов.

### 6. Многопоточность: ###
- Каждый пользователь обрабатывается в своём потоке, сервер поддерживает работу с несколькими пользователями одновременно.  
- Потокобезопасность: Для хранения активных пользователей используется потокобезопасная ConcurrentHashMap в виде Map<String, PrintWriter> clientWriters.    

### 7. Обработка ошибок и отключений: ###
- Если пользователь отключается или происходит ошибка, ClientHandler закрывает соединение, удаляет пользователя из списка активных пользователей и записывает событие в лог.  
- Пользователь может отправить команду "exit", чтобы самому покинуть чат, сервер в этом случае отключает пользователя.    

### 8. Файлы: ###
Файл настроек: settings.txt - Содержит конфигурацию сервера (адрес и порт).  
Файл пользователей: users.txt - хранит учетные данные для авторизации в виде login:password.  
Файл логов: log.txt - хранит логи, связанные с работой сервера и взаимодействием с пользователями, а также сообщения пользователей.  
Файл логов: error_log.txt - хранит логи, связанные с ошибками при работе Сервера.    


